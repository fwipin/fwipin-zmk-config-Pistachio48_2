#include <dt-bindings/zmk/matrix_transform.h>

/ {
    chosen {
        zmk,kscan = &kscan0;
        zmk,matrix_transform = &default_transform;
    };

    kscan0: kscan {
        compatible = "zmk,kscan-gpio-charlieplex";
        wakeup-source;
        //diode-direction = "row2col";
        interrupt-gpios= <&xiao_d 9 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>;
        gpios
            = <&xiao_d 0  GPIO_ACTIVE_HIGH> 
            , <&xiao_d 1  GPIO_ACTIVE_HIGH> 
            , <&xiao_d 2  GPIO_ACTIVE_HIGH> 
            , <&xiao_d 3  GPIO_ACTIVE_HIGH> 
            , <&xiao_d 6  GPIO_ACTIVE_HIGH> 
            , <&xiao_d 10 GPIO_ACTIVE_HIGH> 
            ; // addressable space is 6x5
    };

    default_transform: keymap_transform {
        compatible = "zmk,matrix-transform";
        columns = <12>;
        rows = <6>;
        map = <
        /*
            RC(0, 1) RC(0, 2) RC(0, 3) RC(0, 4) RC(0, 5)	                   RC(6, 7)  RC(6, 8)  RC(6, 9)  RC(6, 10)  RC(6, 11)
            RC(1, 0) RC(1, 2) RC(1, 3) RC(1, 4) RC(1, 5)                       RC(7, 6)	 RC(7, 8)  RC(7, 9)  RC(7, 10)  RC(7, 11)
            RC(2, 0) RC(2, 1) RC(2, 3) RC(2, 4) RC(2, 5) RC(5, 2)    RC(11, 8) RC(8, 6)  RC(8, 7)  RC(8, 9)  RC(8, 10)  RC(8, 11)
                              RC(3, 2) RC(3, 4) RC(3, 5) RC(5, 3)    RC(11, 7) RC(9, 6)  RC(9, 7)  RC(9, 8)	 
                              RC(4, 2) RC(4, 3)	RC(4, 5) RC(5, 4)    RC(11, 6) RC(10, 6) RC(10, 7) RC(10, 8)
        */
            RC(0, 1) RC(0, 2) RC(0, 3) RC(0, 4) RC(0, 5)	                    RC(6, 11)  RC(6, 10)  RC(6, 9)  RC(6, 8)  RC(6, 7)
            RC(1, 0) RC(1, 2) RC(1, 3) RC(1, 4) RC(1, 5)                        RC(7, 11)  RC(7, 10)  RC(7, 9)  RC(7, 8)  RC(7, 6)
            RC(2, 0) RC(2, 1) RC(2, 3) RC(2, 4) RC(2, 5) RC(5, 2)    RC(11, 8)  RC(8, 11)  RC(8, 10)  RC(8, 9)  RC(8, 7)  RC(8, 6)
                              RC(3, 2) RC(3, 4) RC(3, 5) RC(5, 3)    RC(11, 9)  RC(9, 11)  RC(9, 10)  RC(9, 8)	 
                              RC(4, 2) RC(4, 3)	RC(4, 5) RC(5, 4)    RC(11, 10) RC(10,11)  RC(10, 9)  RC(10, 8)
        >;
    };

    left_encoder1: encoder_left1 {
        compatible = "alps,ec11";
        a-gpios = <&xiao_d 9 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        b-gpios = <&xiao_d 8 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        steps = <24>;
        status = "disabled";
    };

    left_encoder2: encoder_left2 {
        compatible = "alps,ec11";
        a-gpios = <&gpio0 8 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        b-gpios = <&gpio0 7 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        steps = <24>;
        status = "disabled";
    };

    right_encoder1: encoder_right1 {
        compatible = "alps,ec11";
        a-gpios = <&xiao_d 9 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        b-gpios = <&xiao_d 8 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        steps = <24>;
        status = "disabled";
    };

    right_encoder2: encoder_right2 {
        compatible = "alps,ec11";
        a-gpios = <&gpio0 8  (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        b-gpios = <&gpio0 7  (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        steps = <24>;
        status = "disabled";
    };

    sensors: sensors {
        compatible = "zmk,keymap-sensors";
        sensors = <&right_encoder1 &right_encoder2 &left_encoder1 &left_encoder2>;
        triggers-per-rotation = <20>;
    };
};
